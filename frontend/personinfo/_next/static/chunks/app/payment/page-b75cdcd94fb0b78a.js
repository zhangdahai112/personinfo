(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{94:(e,r,t)=>{Promise.resolve().then(t.bind(t,120))},120:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var a=t(2372),n=t(8978),i=t(5041),l=t(8734),c=t(9084),o=t(1582),d=t(1332),s=t(5);let u=(0,s.A)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),m=(0,s.A)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function p(){let{currentOrder:e,processPayment:r}=(0,d.u)(),[t,s]=(0,n.useState)("alipay"),[p,h]=(0,n.useState)(!1),y=async()=>{if(!e)return;h(!0);let a=await r(e.id,t);h(!1),a?alert("支付成功！"):alert("支付失败，请重试")};return e?(0,a.FD)("div",{className:"min-h-screen",children:[(0,a.Y)(i.Navigation,{}),(0,a.Y)("main",{className:"py-12 bg-gray-50",children:(0,a.Y)("div",{className:"max-w-2xl mx-auto px-4",children:(0,a.FD)(o.Zp,{children:[(0,a.Y)(o.aR,{children:(0,a.Y)(o.ZB,{children:"支付订单"})}),(0,a.Y)(o.Wu,{children:(0,a.FD)("div",{className:"space-y-6",children:[(0,a.FD)("div",{children:[(0,a.Y)("h3",{className:"font-semibold mb-4",children:"订单信息"}),(0,a.FD)("p",{children:["服务类型：",e.serviceType]}),(0,a.FD)("p",{children:["紧急程度：",e.urgencyLevel]}),(0,a.FD)("p",{children:["总金额：\xa5",(e.totalAmount/100).toFixed(2)]})]}),(0,a.FD)("div",{children:[(0,a.Y)("h3",{className:"font-semibold mb-4",children:"选择支付方式"}),(0,a.FD)("div",{className:"space-y-3",children:[(0,a.Y)("div",{className:"border p-4 rounded cursor-pointer ".concat("alipay"===t?"border-blue-500":""),onClick:()=>s("alipay"),children:(0,a.FD)("div",{className:"flex items-center",children:[(0,a.Y)(u,{className:"w-6 h-6 mr-3"}),(0,a.Y)("span",{children:"支付宝"})]})}),(0,a.Y)("div",{className:"border p-4 rounded cursor-pointer ".concat("wechat"===t?"border-green-500":""),onClick:()=>s("wechat"),children:(0,a.FD)("div",{className:"flex items-center",children:[(0,a.Y)(m,{className:"w-6 h-6 mr-3"}),(0,a.Y)("span",{children:"微信支付"})]})})]})]}),(0,a.Y)(c.$,{onClick:y,disabled:p,className:"w-full",variant:"chinese",children:p?"支付中...":"立即支付 \xa5".concat((e.totalAmount/100).toFixed(2))})]})})]})})}),(0,a.Y)(l.Footer,{})]}):(0,a.Y)("div",{children:"未找到订单信息"})}},1332:(e,r,t)=>{"use strict";t.d(r,{PaymentProvider:()=>l,u:()=>c});var a=t(2372),n=t(8978);let i=(0,n.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[c,o]=(0,n.useState)([]),d=(e,r,a)=>{o(n=>n.map(n=>{if(n.id===e){let e={...n,status:r,paymentMethod:a,paidAt:"已支付"===r?new Date().toISOString():n.paidAt};return n.id===(null==t?void 0:t.id)&&l(e),e}return n}))},s=e=>c.find(r=>r.id===e),u=async(e,r)=>{try{d(e,"支付中",r);let t=s(e);if(!t)return!1;let a="alipay"===r?"alipay://pay?orderNo=".concat(e,"&amount=").concat(t.totalAmount):"weixin://wxpay/bizpayurl?pr=wx".concat(Date.now());if(console.log("支付链接生成: ".concat(a)),await new Promise(e=>setTimeout(e,3e3)),Math.random()>.15)return d(e,"已支付",r),!0;return d(e,"支付失败",r),!1}catch(t){return console.error("Payment processing error:",t),d(e,"支付失败",r),!1}},m=async e=>{let r=s(e);return r?(await new Promise(e=>setTimeout(e,500)),"支付中"===r.status&&Math.random()>.3)?(d(e,"已支付"),"已支付"):r.status:"已取消"};return(0,a.Y)(i.Provider,{value:{currentOrder:t,orderHistory:c,createOrder:e=>{let r={基础查询:5e3,全面查询:12e3,复杂查询:2e4,咨询服务:200}[e.serviceType||"基础查询"],t=r*({普通:0,加急:.3,特急:.5})[e.urgencyLevel||"普通"],a={id:"ORDER_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),userId:e.userId||"",serviceType:e.serviceType||"基础查询",amount:r,urgencyLevel:e.urgencyLevel||"普通",urgencyFee:t,totalAmount:r+t,status:"待支付",createdAt:new Date().toISOString(),description:e.description||"",queryDetails:e.queryDetails};return l(a),o(e=>[a,...e]),a},updateOrderStatus:d,getOrderById:s,processPayment:u,generatePaymentQR:(e,r)=>{let t=s(e);if(!t)return"";let a="alipay"===r?"alipay://pay?orderNo=".concat(e,"&amount=").concat(t.totalAmount):"weixin://wxpay/bizpayurl?pr=wx".concat(Date.now());return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(encodeURIComponent(a))},calculateServicePrice:(e,r)=>{let t={基础查询:5e3,全面查询:12e3,复杂查询:2e4,咨询服务:200}[e],a=t*({普通:0,加急:.3,特急:.5})[r];return{baseAmount:t,urgencyFee:a,totalAmount:t+a}},queryPaymentStatus:m},children:r})}function c(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("usePayment must be used within a PaymentProvider");return e}},1582:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>s,ZB:()=>o,Zp:()=>l,aR:()=>c});var a=t(2372),n=t(8978),i=t(29);let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg hover:shadow-red-100/50",t),...n})});l.displayName="Card";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...n})});c.displayName="CardHeader";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight text-slate-900",t),...n})});o.displayName="CardTitle";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let s=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...n})});s.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.Y)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"}},e=>{e.O(0,[372,255,322,359,876,358],()=>e(e.s=94)),_N_E=e.O()}]);