(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{222:(e,t,a)=>{Promise.resolve().then(a.bind(a,9070))},419:(e,t,a)=>{"use strict";var r=a(1675);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},1332:(e,t,a)=>{"use strict";a.d(t,{PaymentProvider:()=>c,u:()=>n});var r=a(2372),s=a(8978);let l=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,s.useState)(null),[n,i]=(0,s.useState)([]),d=(e,t,r)=>{i(s=>s.map(s=>{if(s.id===e){let e={...s,status:t,paymentMethod:r,paidAt:"已支付"===t?new Date().toISOString():s.paidAt};return s.id===(null==a?void 0:a.id)&&c(e),e}return s}))},o=e=>n.find(t=>t.id===e),u=async(e,t)=>{try{d(e,"支付中",t);let a=o(e);if(!a)return!1;let r="alipay"===t?"alipay://pay?orderNo=".concat(e,"&amount=").concat(a.totalAmount):"weixin://wxpay/bizpayurl?pr=wx".concat(Date.now());if(console.log("支付链接生成: ".concat(r)),await new Promise(e=>setTimeout(e,3e3)),Math.random()>.15)return d(e,"已支付",t),!0;return d(e,"支付失败",t),!1}catch(a){return console.error("Payment processing error:",a),d(e,"支付失败",t),!1}},m=async e=>{let t=o(e);return t?(await new Promise(e=>setTimeout(e,500)),"支付中"===t.status&&Math.random()>.3)?(d(e,"已支付"),"已支付"):t.status:"已取消"};return(0,r.Y)(l.Provider,{value:{currentOrder:a,orderHistory:n,createOrder:e=>{let t={基础查询:5e3,全面查询:12e3,复杂查询:2e4,咨询服务:200}[e.serviceType||"基础查询"],a=t*({普通:0,加急:.3,特急:.5})[e.urgencyLevel||"普通"],r={id:"ORDER_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),userId:e.userId||"",serviceType:e.serviceType||"基础查询",amount:t,urgencyLevel:e.urgencyLevel||"普通",urgencyFee:a,totalAmount:t+a,status:"待支付",createdAt:new Date().toISOString(),description:e.description||"",queryDetails:e.queryDetails};return c(r),i(e=>[r,...e]),r},updateOrderStatus:d,getOrderById:o,processPayment:u,generatePaymentQR:(e,t)=>{let a=o(e);if(!a)return"";let r="alipay"===t?"alipay://pay?orderNo=".concat(e,"&amount=").concat(a.totalAmount):"weixin://wxpay/bizpayurl?pr=wx".concat(Date.now());return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(encodeURIComponent(r))},calculateServicePrice:(e,t)=>{let a={基础查询:5e3,全面查询:12e3,复杂查询:2e4,咨询服务:200}[e],r=a*({普通:0,加急:.3,特急:.5})[t];return{baseAmount:a,urgencyFee:r,totalAmount:a+r}},queryPaymentStatus:m},children:t})}function n(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("usePayment must be used within a PaymentProvider");return e}},1370:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(5).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1582:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>o,ZB:()=>i,Zp:()=>c,aR:()=>n});var r=a(2372),s=a(8978),l=a(29);let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg hover:shadow-red-100/50",a),...s})});c.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight text-slate-900",a),...s})});i.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});o.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.Y)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},6112:(e,t,a)=>{"use strict";a.d(t,{p:()=>s});var r=a(2372);let s=a(8978).forwardRef((e,t)=>{let{className:a,type:s,...l}=e;return(0,r.Y)("input",{type:s,className:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ".concat(a||""),ref:t,...l})});s.displayName="Input"},7447:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(5).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8313:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(5).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},8677:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(5).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},9070:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(2372),s=a(8978),l=a(419),c=a(5041),n=a(8734),i=a(9084),d=a(6112),o=a(1582),u=a(1332),m=a(7447),h=a(8313);let p=(0,a(5).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var y=a(1370),f=a(8677);function x(){let{getOrderById:e,queryPaymentStatus:t}=(0,u.u)(),a=(0,l.useRouter)(),x=(0,l.useSearchParams)(),[N,v]=(0,s.useState)(x.get("orderId")||""),[Y,g]=(0,s.useState)(null),[w,b]=(0,s.useState)(!1),[D,F]=(0,s.useState)(""),A=(0,s.useCallback)(async a=>{let r=a||N;if(!r.trim())return void F("请输入订单号");b(!0),F("");try{let a=e(r);if(!a){F("未找到该订单"),g(null);return}let s=await t(r);g({...a,status:s})}catch(e){F("查询失败，请重试")}finally{b(!1)}},[N,e,t]);(0,s.useEffect)(()=>{let e=x.get("orderId");e&&A(e)},[x]);let k=e=>"\xa5".concat((e/100).toFixed(2)),C=e=>new Date(e).toLocaleString("zh-CN");return(0,r.FD)("div",{className:"min-h-screen",children:[(0,r.Y)(c.Navigation,{}),(0,r.Y)("main",{className:"py-12 bg-gray-50",children:(0,r.FD)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.FD)("div",{className:"text-center mb-8",children:[(0,r.Y)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"支付状态查询"}),(0,r.Y)("p",{className:"text-gray-600",children:"输入订单号查询支付状态"})]}),(0,r.FD)(o.Zp,{className:"mb-6",children:[(0,r.Y)(o.aR,{children:(0,r.Y)(o.ZB,{children:"订单查询"})}),(0,r.FD)(o.Wu,{children:[(0,r.FD)("div",{className:"flex space-x-4",children:[(0,r.Y)(d.p,{placeholder:"请输入订单号",value:N,onChange:e=>v(e.target.value),className:"flex-1"}),(0,r.Y)(i.$,{onClick:()=>A(),disabled:w,variant:"chinese",className:"min-w-[100px]",children:w?(0,r.FD)("div",{className:"flex items-center",children:[(0,r.Y)(h.A,{className:"w-4 h-4 mr-2 animate-spin"}),"查询中"]}):(0,r.FD)("div",{className:"flex items-center",children:[(0,r.Y)(f.A,{className:"w-4 h-4 mr-2"}),"查询"]})})]}),D&&(0,r.Y)("p",{className:"text-red-600 text-sm mt-2",children:D})]})]}),Y&&(0,r.Y)(o.Zp,{children:(0,r.FD)(o.Wu,{className:"p-8",children:[(0,r.FD)("div",{className:"text-center mb-6",children:[(e=>{switch(e){case"已支付":return(0,r.Y)(m.A,{className:"w-8 h-8 text-green-500"});case"支付中":return(0,r.Y)(h.A,{className:"w-8 h-8 text-blue-500 animate-spin"});case"支付失败":return(0,r.Y)(p,{className:"w-8 h-8 text-red-500"});case"已取消":return(0,r.Y)(y.A,{className:"w-8 h-8 text-gray-500"});default:return(0,r.Y)(h.A,{className:"w-8 h-8 text-yellow-500"})}})(Y.status),(0,r.Y)("h2",{className:"text-2xl font-semibold mt-4 ".concat((e=>{switch(e){case"已支付":return"text-green-600";case"支付中":return"text-blue-600";case"支付失败":return"text-red-600";case"已取消":return"text-gray-600";default:return"text-yellow-600"}})(Y.status)),children:Y.status})]}),(0,r.FD)("div",{className:"space-y-4",children:[(0,r.FD)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.FD)("div",{children:[(0,r.Y)("span",{className:"text-gray-600",children:"订单号："}),(0,r.Y)("span",{className:"font-medium",children:Y.id})]}),(0,r.FD)("div",{children:[(0,r.Y)("span",{className:"text-gray-600",children:"支付方式："}),(0,r.Y)("span",{className:"font-medium",children:"alipay"===Y.paymentMethod?"支付宝":"wechat"===Y.paymentMethod?"微信支付":"未选择"})]}),(0,r.FD)("div",{children:[(0,r.Y)("span",{className:"text-gray-600",children:"服务类型："}),(0,r.Y)("span",{className:"font-medium",children:Y.serviceType})]}),(0,r.FD)("div",{children:[(0,r.Y)("span",{className:"text-gray-600",children:"紧急程度："}),(0,r.Y)("span",{className:"font-medium",children:Y.urgencyLevel})]})]}),(0,r.Y)("div",{className:"border-t pt-4",children:(0,r.FD)("div",{className:"space-y-2",children:[(0,r.FD)("div",{className:"flex justify-between",children:[(0,r.Y)("span",{children:"基础费用："}),(0,r.Y)("span",{children:k(Y.amount)})]}),Y.urgencyFee>0&&(0,r.FD)("div",{className:"flex justify-between",children:[(0,r.Y)("span",{children:"加急费用："}),(0,r.Y)("span",{children:k(Y.urgencyFee)})]}),(0,r.FD)("div",{className:"flex justify-between font-semibold text-lg border-t pt-2",children:[(0,r.Y)("span",{children:"总计："}),(0,r.Y)("span",{className:"text-red-600",children:k(Y.totalAmount)})]})]})}),(0,r.Y)("div",{className:"border-t pt-4 text-sm text-gray-600",children:(0,r.FD)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.FD)("div",{children:[(0,r.Y)("span",{children:"创建时间："}),(0,r.Y)("div",{children:C(Y.createdAt)})]}),Y.paidAt&&(0,r.FD)("div",{children:[(0,r.Y)("span",{children:"支付时间："}),(0,r.Y)("div",{children:C(Y.paidAt)})]})]})}),Y.description&&(0,r.FD)("div",{className:"border-t pt-4",children:[(0,r.Y)("span",{className:"text-gray-600",children:"订单描述："}),(0,r.Y)("p",{className:"mt-1",children:Y.description})]})]}),(0,r.FD)("div",{className:"mt-6 space-y-3",children:["待支付"===Y.status&&(0,r.Y)(i.$,{variant:"chinese",className:"w-full",onClick:()=>a.push("/payment?orderId=".concat(Y.id)),children:"立即支付"}),"支付中"===Y.status&&(0,r.Y)(i.$,{variant:"outline",className:"w-full",onClick:()=>A(),disabled:w,children:"刷新状态"}),(0,r.Y)(i.$,{variant:"outline",className:"w-full",onClick:()=>a.push("/dashboard"),children:"返回仪表板"})]})]})}),(0,r.FD)(o.Zp,{className:"mt-6",children:[(0,r.Y)(o.aR,{children:(0,r.Y)(o.ZB,{children:"常见问题"})}),(0,r.Y)(o.Wu,{children:(0,r.FD)("div",{className:"space-y-3 text-sm",children:[(0,r.FD)("div",{children:[(0,r.Y)("h4",{className:"font-semibold",children:"Q: 支付后多久能看到状态更新？"}),(0,r.Y)("p",{className:"text-gray-600",children:"A: 通常在2-5分钟内系统会自动更新支付状态。"})]}),(0,r.FD)("div",{children:[(0,r.Y)("h4",{className:"font-semibold",children:"Q: 支付失败怎么办？"}),(0,r.Y)("p",{className:"text-gray-600",children:"A: 可以重新选择支付方式进行支付，或联系客服处理。"})]}),(0,r.FD)("div",{children:[(0,r.Y)("h4",{className:"font-semibold",children:"Q: 如何获取发票？"}),(0,r.Y)("p",{className:"text-gray-600",children:"A: 支付成功后可在个人中心申请开具发票。"})]})]})})]})]})}),(0,r.Y)(n.Footer,{})]})}function N(){return(0,r.Y)(s.Suspense,{fallback:(0,r.Y)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.Y)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})}),children:(0,r.Y)(x,{})})}}},e=>{e.O(0,[372,255,322,359,876,358],()=>e(e.s=222)),_N_E=e.O()}]);